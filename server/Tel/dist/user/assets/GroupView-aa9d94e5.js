import{_ as S,s as J,o as n,c as a,a as f,F as L,r as N,b as c,t as M,d as l,e as O,f as V,w as T,g as j,I as A,h as W,i as P,B as D,p as q,j as Y,k as p,l as K,m as Q,n as X,q as I,u as Z,P as $,v as ee,G as se,x as te,U as oe}from"./index-a2533353.js";const ne={props:{user:Object,service:Object,msgList:Array,users:Object,group:Object},setup(u){return{props:u,showImagePreview:J,getTime:function(e){var _=Math.floor(Date.now()/1e3),v=_-e;if(v<60)return"刚刚";if(v<3600){var m=Math.floor(v/60);return m+"分钟前"}else{var g=new Date(e*1e3),k=g.getFullYear(),y=("0"+(g.getMonth()+1)).slice(-2),s=("0"+g.getDate()).slice(-2),w=("0"+g.getHours()).slice(-2),h=("0"+g.getMinutes()).slice(-2),z=k+"-"+y+"-"+s+" "+w+":"+h;return z}},copy:function(e,_){console.log("复制",e);var v=document.createElement("input");v.setAttribute("value",e),document.body.appendChild(v),v.select();var m=document.execCommand("copy");m&&document.body.removeChild(v),j(_)}}}},F=u=>(q("data-v-3e582e46"),u=u(),Y(),u),ae={class:"MessageComponent userMessage"},le={key:0,class:"message_left"},ce={class:"head"},re=["src"],ie={class:"content"},de={key:0,class:"title"},ue={key:1,class:"title"},_e=["onClick"],ve={key:4,width:"320",height:"240",controls:"controls"},ge=["src"],he=["src"],pe=["onClick"],fe=F(()=>c("div",{class:"head"},null,-1)),ye={key:1,class:"message_left"},me={class:"head"},ke=["src"],we={class:"content"},Ce={key:0,class:"title"},xe={key:1,class:"title"},be=["onClick"],Me={key:4,width:"320",height:"240",controls:"controls"},Ie=["src"],Te=["src"],Oe=["onClick"],Ve=F(()=>c("div",{class:"head"},null,-1)),ze={key:2,class:"message_right"},Be=F(()=>c("div",{class:"head"},null,-1)),Fe={class:"content"},Ge={key:0,class:"title"},Se=["onClick"],Le={key:3,width:"320",height:"240",controls:"controls"},Ne=["src"],je=["src"],Pe={class:"head"},De=["src"];function Ee(u,i,d,e,_,v){const m=A,g=W,k=P,y=D;return n(),a("div",ae,[f(m),(n(!0),a(L,null,N(e.props.msgList,(s,w)=>(n(),a("div",{key:w},[s.send_role=="service"||s.send_role=="hello"?(n(),a("div",le,[c("div",ce,[c("img",{style:{width:"40px",height:"40px"},src:e.props.service.head},null,8,re)]),c("div",ie,[d.service.user_detail=="default"||d.service.user_detail=="business"?(n(),a("div",de,M(e.getTime(s.time)),1)):l("",!0),d.service.user_detail=="clean"?(n(),a("div",ue,M(d.service.name),1)):l("",!0),s.type=="text"?(n(),a("span",{key:2,class:"content_text",onClick:h=>e.copy(s.content,"复制成功"),style:{color:"#000"}},M(s.content),9,_e)):l("",!0),s.type=="image"?(n(),O(g,{key:3,src:s.content,onClick:h=>e.showImagePreview([s.content])},null,8,["src","onClick"])):l("",!0),s.type=="video"?(n(),a("video",ve,[c("source",{src:s.content,type:"video/ogg"},null,8,ge),c("source",{src:s.content,type:"video/mp4"},null,8,he),V(" 无法播放. ")])):l("",!0),s.type=="call"?(n(),a("span",{key:5,class:"call",onClick:h=>e.copy(JSON.parse(s.content).user_link,"复制成功,请浏览器打开")},[f(y,{size:"small",type:"primary"},{default:T(()=>[f(k,{name:"phone"}),V(" 打开视频通话")]),_:1})],8,pe)):l("",!0)]),fe])):l("",!0),s.send_role=="user"&&s.send_role_id!=d.user.user_id?(n(),a("div",ye,[c("div",me,[c("img",{style:{width:"40px",height:"40px"},src:e.props.users[s.send_role_id].head},null,8,ke)]),c("div",we,[d.service.user_detail=="default"||d.service.user_detail=="business"?(n(),a("div",Ce,M(e.getTime(s.time)),1)):l("",!0),d.service.user_detail=="clean"?(n(),a("div",xe,M(e.props.users[s.send_role_id].name),1)):l("",!0),s.type=="text"?(n(),a("span",{key:2,class:"content_text",onClick:h=>e.copy(s.content,"复制成功"),style:{color:"#000"}},M(s.content),9,be)):l("",!0),s.type=="image"?(n(),O(g,{key:3,src:s.content,onClick:h=>e.showImagePreview([s.content])},null,8,["src","onClick"])):l("",!0),s.type=="video"?(n(),a("video",Me,[c("source",{src:s.content,type:"video/ogg"},null,8,Ie),c("source",{src:s.content,type:"video/mp4"},null,8,Te),V(" 无法播放. ")])):l("",!0),s.type=="call"?(n(),a("span",{key:5,class:"call",onClick:h=>e.copy(JSON.parse(s.content).user_link,"复制成功,请浏览器打开")},[f(y,{size:"small",type:"primary"},{default:T(()=>[f(k,{name:"phone"}),V(" 打开视频通话")]),_:1})],8,Oe)):l("",!0)]),Ve])):l("",!0),s.send_role=="user"&&s.send_role_id==d.user.user_id?(n(),a("div",ze,[Be,c("div",Fe,[d.service.user_detail=="default"||d.service.user_detail=="business"?(n(),a("div",Ge,M(e.getTime(s.time)),1)):l("",!0),s.type=="text"?(n(),a("span",{key:1,class:"content_text",onClick:h=>e.copy(s.content)},M(s.content),9,Se)):l("",!0),s.type=="image"?(n(),O(g,{key:2,style:{height:"200px"},src:s.content,onClick:h=>e.showImagePreview([s.content])},null,8,["src","onClick"])):l("",!0),s.type=="video"?(n(),a("video",Le,[c("source",{src:s.content,type:"video/ogg"},null,8,Ne),c("source",{src:s.content,type:"video/mp4"},null,8,je),V(" 无法播放. ")])):l("",!0)]),c("div",Pe,[c("img",{style:{width:"40px",height:"40px"},src:e.props.user.user_head},null,8,De)])])):l("",!0)]))),128))])}const Re=S(ne,[["render",Ee],["__scopeId","data-v-3e582e46"]]);const Ue={components:{GroupMessage:Re},setup(){const u=p(!1),i=p(!1),d=p({}),e=p({}),_=p([]),v=p(""),m=p(["😀","😃","😄","😁","😆","😅","🤣","😂","🙂","😉","😊","😍","🤩","😘","😗","🤔","😝","🤪","😜","😏","😒","🙄","😔","😷","😟","😳","😧","😨","😭","😓","😣","❤️","💔","👄","👂","🧠","👀","🛌","⌛","👗","💦","💫","💥","💢","💯","💟","🌹","🥀","🌺","🌝","🌚","👋","🤚","👌","✌️","🤟","🤘","👍","👎","✊","🙌","👐","🤲","🙏","💪"]),g=p(0),k=p(!1),y=p({}),s=p({}),w=t=>{I.post("api/user/group/message",{limit:10,id:g.value}).then(o=>{o.data.data.list.length>0&&(g.value=o.data.data.list[o.data.data.list.length-1].id);for(let b=0;b<o.data.data.list.length;b++)_.value.unshift(o.data.data.list[b]);k.value=!1,t&&r()})},h=()=>{I.post("api/user/group/send",{type:"text",content:v.value}),v.value="",u.value=!1,i.value=!1},z=function(t){if(console.log(t),t.type=="clear_all_msg"||t.type=="clear"){_.value=[];return}if(t.type=="remove",t.type=="call"&&r(),t.type=="group_message"){if(t.content.type=="remove"){for(var o=_.value.length-1;o>0;o--)if(_.value[o].id==t.content.content){_.value.splice(o,1);break}return}console.log("group msg"),R(t.content),r();return}},r=()=>{setTimeout(()=>{var t=document.getElementsByClassName("userMessage");for(let o=0;o<t.length;o++)console.log("scrolltop",t[o].scrollTop,t[o].scrollHeight),t[o].scrollTop=t[o].scrollHeight},14)},C=p(null),x=p(null);let E="ws://"+K()+"/websocket/conn?token="+Q();const G=()=>{x.value!=null&&clearInterval(x.value),C.value!=null&&C.value.close(),C.value=new WebSocket(E),C.value.onmessage=function(t){let o=JSON.parse(t.data);z(o)},C.value.onclose=function(){x.value!=null&&clearInterval(x.value),x.value=setTimeout(G(),3e3)},C.value.onopen=function(t){x.value!=null&&clearInterval(x.value),x.value=setInterval(function(){C.value.send("ping")},5e3)}},R=t=>{t.send_role=="user"&&!(t.send_role_id in s)?I.post("/api/user/group/user",{user_id:t.send_role_id}).then(o=>{console.log("addUsers,e",o.data.data.user),s.value[o.data.data.user.user_id]=o.data.data.user,_.value.push(t),r()}):_.value.push(t)},U=function(t,o){console.log("upload",o.file),o.status="uploading",o.message="上传中...",setTimeout(()=>{o.status="failed",o.message="上传成功"},1e3);let b=new FormData;b.append("image",o.file),I.post("/api/upload",b).then(function(B){B.data.code===200&&I.post("api/user/group/send",{type:t,content:B.data.data.file_name}),console.log("response",B)})},H=function(){I.post("/api/user/group/detail").then(t=>{console.log("init group",t.data.data),y.value=t.data.data.group;let o={};t.data.data.users.forEach(b=>{o[b.user_id]=b}),console.log("list",o),s.value=o,document.title=y.value.group_name,w(!0)})};return X(()=>{I.post("/api/user/info").then(t=>{d.value=t.data.data.users,e.value=t.data.data.service}),H(),G()}),{message:v,showOther:u,showFace:i,emoji:m,msgList:_,user:d,users:s,service:e,loading:k,loadMsg:w,sendMsg:h,afterRead:U,showToast:j}}},He={class:"main"},Je={class:"content"},Ae={class:"content-refresh userMessage"},We={class:"send"},qe={class:"send_input"},Ye={class:"send_btn"},Ke={key:0,class:"other"},Qe={key:1,class:"face"},Xe=["onClick"];function Ze(u,i,d,e,_,v){const m=Z("GroupMessage"),g=$,k=ee,y=P,s=D,w=te,h=oe,z=se;return n(),a("main",He,[c("div",Je,[c("div",Ae,[f(g,{modelValue:e.loading,"onUpdate:modelValue":i[0]||(i[0]=r=>e.loading=r),onRefresh:i[1]||(i[1]=r=>e.loadMsg(!1))},{default:T(()=>[f(m,{users:e.users,msgList:e.msgList,user:e.user,service:e.service,group:u.group},null,8,["users","msgList","user","service","group"])]),_:1},8,["modelValue"])])]),c("div",We,[c("div",qe,[f(k,{modelValue:e.message,"onUpdate:modelValue":i[2]||(i[2]=r=>e.message=r),rows:"1",autosize:"",placeholder:"请输入消息",maxlength:"255"},null,8,["modelValue"])]),c("div",Ye,[f(y,{name:"smile",onClick:i[3]||(i[3]=r=>(e.showFace=!e.showFace)&&(e.showOther=!1)),size:"32"}),e.message==""?(n(),O(y,{key:0,onClick:i[4]||(i[4]=r=>(e.showOther=!e.showOther)&&(e.showFace=!1)),name:"add",size:"32"})):l("",!0),e.message!=""?(n(),O(s,{key:1,size:"small",type:"primary",onClick:e.sendMsg},{default:T(()=>[V("发送")]),_:1},8,["onClick"])):l("",!0)])]),e.showOther?(n(),a("div",Ke,[f(z,{gutter:10,border:"false"},{default:T(()=>[f(h,{"max-count":1,"max-size":8*1024*1024,accept:"image/*",onOversize:i[5]||(i[5]=r=>{e.showToast("大小不能超过8MB")}),"after-read":r=>{e.afterRead("image",r)}},{default:T(()=>[(n(),O(w,{border:"false",key:u.value,icon:"photo"}))]),_:1},8,["after-read"]),f(h,{"max-count":1,"max-size":20*1024*1024,accept:"video/*",onOversize:i[6]||(i[6]=r=>{e.showToast("大小不能超过20MB"),u.versize}),"after-read":r=>{e.afterRead("video",r)}},{default:T(()=>[(n(),O(w,{border:"false",key:u.value,icon:"video"}))]),_:1},8,["after-read"])]),_:1})])):l("",!0),e.showFace?(n(),a("div",Qe,[(n(!0),a(L,null,N(e.emoji,(r,C)=>(n(),a("span",{key:C,onClick:x=>e.message=e.message+r},M(r),9,Xe))),128))])):l("",!0)])}const es=S(Ue,[["render",Ze],["__scopeId","data-v-9ae722ea"]]);export{es as default};
